{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '42030111-51447223cbabab8b20d1b63f9';\n\nlet currentPage = 1;\nlet searchWord = '';\nconst perPage = 15;\n\nconst refs = {\n  form: document.querySelector('.form'),\n  list: document.querySelector('.gallery-list'),\n  loader: document.querySelector('.loader'),\n  loaderMore: document.querySelector('.loader-more'),\n  btnUp: document.querySelector('.up-btn'),\n  loadMore: document.querySelector('.load-more'),\n};\n\nrefs.loader.style.display = 'none';\nrefs.loaderMore.style.display = 'none';\nrefs.loadMore.style.display = 'none';\nrefs.btnUp.style.display = 'none';\n\nrefs.form.addEventListener('submit', handleSearch);\nrefs.loadMore.addEventListener('click', handleLoad);\n\nconst simplelightbox = new SimpleLightbox('.gallery a', {\n  captions: true,\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nasync function handleSearch(evt) {\n  evt.preventDefault();\n\n  const form = evt.currentTarget;\n  searchWord = form.elements.search.value.trim();\n  currentPage = 1;\n\n  refs.list.innerHTML = '';\n  refs.loader.style.display = 'block';\n  refs.loadMore.style.display = 'none';\n  refs.loaderMore.style.display = 'none';\n\n  if (!searchWord) {\n    iziToast.error({\n      title: 'Error',\n      message: 'Please enter something in the search',\n    });\n    refs.loader.style.display = 'none';\n    return;\n  }\n  try {\n    const data = await searchPhotoByName(searchWord, currentPage);\n    const arr = data.hits;\n    if (!arr.length) {\n      iziToast.error({\n        title: 'Error',\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n      });\n      return;\n    }\n    const totalPages = Math.ceil(data.totalHits / perPage);\n\n    if (data.totalHits === totalPages) {\n      refs.loaderMore.style.display = 'none';\n      refs.loadMore.style.display = 'none';\n    } else {\n      refs.loadMore.style.display = 'block';\n    }\n    if (arr.length < perPage) {\n      refs.loadMore.style.display = 'none';\n      iziToast.info({\n        title: 'Warning',\n        message: `We're sorry, but you've reached the end of search results.`,\n      });\n    }\n    refs.list.insertAdjacentHTML('beforeend', createMarkup(arr));\n    simplelightbox.refresh();\n  } catch (err) {\n    iziToast.error({\n      title: 'Error',\n      message: `${err}`,\n    });\n  } finally {\n    form.reset();\n    refs.loader.style.display = 'none';\n  }\n}\n\nasync function handleLoad() {\n  currentPage += 1;\n\n  refs.loaderMore.style.display = 'block';\n  refs.loadMore.style.display = 'none';\n\n  const getHeightImgCard = () =>\n    document.querySelector('.gallery-item').getBoundingClientRect();\n  try {\n    const data = await searchPhotoByName(searchWord, currentPage);\n    const arr = data.hits;\n\n    if (arr.length === 0) {\n      iziToast.info({\n        title: 'Warning',\n        message: `We're sorry, but you've reached the end of search results.`,\n      });\n    } else {\n      refs.list.insertAdjacentHTML('beforeend', createMarkup(arr));\n      simplelightbox.refresh();\n\n      const totalPages = Math.ceil(data.totalHits / perPage);\n      if (currentPage >= totalPages) {\n        iziToast.info({\n          title: 'Warning',\n          message: `We're sorry, but you've reached the end of search results.`,\n        });\n        refs.loadMore.style.display = 'none';\n      } else {\n        refs.loadMore.style.display = 'block';\n      }\n    }\n  } catch (err) {\n    iziToast.error({\n      title: 'Error',\n      message: `${err}`,\n    });\n  } finally {\n    window.scrollBy({\n      top: getHeightImgCard().height * 2,\n      left: 0,\n      behavior: 'smooth',\n    });\n    refs.loaderMore.style.display = 'none';\n  }\n}\n\nasync function searchPhotoByName(searchWord, currentPage) {\n  try {\n    const resp = await axios.get(`${BASE_URL}/`, {\n      params: {\n        key: API_KEY,\n        q: searchWord,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        per_page: perPage,\n        page: currentPage,\n      },\n    });\n    return resp.data;\n  } catch {\n    iziToast.error({\n      title: 'Error',\n      message: 'Something happend. Try later',\n    });\n  }\n}\n\nfunction createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `<li class=\"gallery-item\">\n          <a class=\"gallery-link\" href=\"${largeImageURL}\">\n            <img\n              class=\"gallery-img\"\n              src=\"${webformatURL}\"\n              alt=\"${tags}\"\n\n            />\n          </a>\n          <div class=\"wrapper\">\n            <div class=\"wrap\">\n              <h2 class=\"header\">Likes</h2>\n              <p class=\"numbers\">${likes}</p>\n            </div>\n            <div class=\"wrap\">\n              <h2 class=\"header\">Views</h2>\n              <p class=\"numbers\">${views}</p>\n            </div>\n            <div class=\"wrap\">\n              <h2 class=\"header\">Comments</h2>\n              <p class=\"numbers\">${comments}</p>\n            </div>\n            <div class=\"wrap\">\n              <h2 class=\"header\">Downloads</h2>\n              <p class=\"numbers\">${downloads}</p>\n            </div>\n          </div>\n        </li>`\n    )\n    .join('');\n}\n"],"names":["BASE_URL","API_KEY","currentPage","searchWord","perPage","refs","handleSearch","handleLoad","simplelightbox","SimpleLightbox","evt","form","iziToast","data","searchPhotoByName","arr","totalPages","createMarkup","err","getHeightImgCard","axios","webformatURL","largeImageURL","tags","likes","views","comments","downloads"],"mappings":"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"}